"use strict";
// Copyright (C) Microsoft Corporation. All rights reserved.
Object.defineProperty(exports, "__esModule", { value: true });
var fs = require("fs-extra");
var process = require('process');
var path = require('path');
var uuidv4 = require('uuid/v4');
var settingVersionId = '1.0';
var userSettingsFileName = 'usersettings.json';
var settings = {
    uniqueId: uuidv4(),
    settingVersion: settingVersionId,
    telemetryEnabled: true
};
// Application Path and User settings file name should be consistent with CLI
function readUserSettings(applicationPath) {
    if (!applicationPath) {
        applicationPath = path.join(process.env.LOCALAPPDATA, 'Microsoft', 'PowerAppsCli');
    }
    var userSettingFilePath = path.join(applicationPath, userSettingsFileName);
    if (fs.existsSync(userSettingFilePath)) {
        var stream = fs.readFileSync(userSettingFilePath, 'utf8');
        try {
            settings = JSON.parse(stream);
            if (settings.uniqueId === '') {
                writeUserSettings(settings, applicationPath);
            }
        }
        catch (err) {
            fs.unlinkSync(userSettingFilePath);
            writeUserSettings(settings, applicationPath);
        }
    }
    else {
        writeUserSettings(settings, applicationPath);
    }
    return settings;
}
exports.readUserSettings = readUserSettings;
function writeUserSettings(userSettings, applicationPath) {
    userSettings = userSettings || settings;
    try {
        fs.ensureDirSync(applicationPath);
        fs.writeFileSync(path.join(applicationPath, userSettingsFileName), JSON.stringify(userSettings));
    }
    catch (err) {
        // catch err
    }
}
