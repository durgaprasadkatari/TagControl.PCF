"use strict";
// Copyright (C) Microsoft Corporation. All rights reserved.
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs-extra");
const process = require('process');
const path = require('path');
const uuidv4 = require('uuid/v4');
const settingVersionId = '1.0';
const userSettingsFileName = 'usersettings.json';
let settings = {
    uniqueId: uuidv4(),
    settingVersion: settingVersionId,
    telemetryEnabled: true
};
// Application Path and User settings file name should be consistent with CLI
function readUserSettings(applicationPath) {
    if (!applicationPath) {
        applicationPath = path.join(process.env.LOCALAPPDATA, 'Microsoft', 'PowerAppsCli');
    }
    const userSettingFilePath = path.join(applicationPath, userSettingsFileName);
    if (fs.existsSync(userSettingFilePath)) {
        const stream = fs.readFileSync(userSettingFilePath, 'utf8');
        try {
            settings = JSON.parse(stream);
            if (settings.uniqueId === '') {
                writeUserSettings(settings, applicationPath);
            }
        }
        catch (err) {
            fs.unlinkSync(userSettingFilePath);
            writeUserSettings(settings, applicationPath);
        }
    }
    else {
        writeUserSettings(settings, applicationPath);
    }
    return settings;
}
exports.readUserSettings = readUserSettings;
function writeUserSettings(userSettings, applicationPath) {
    userSettings = userSettings || settings;
    try {
        fs.ensureDirSync(applicationPath);
        fs.writeFileSync(path.join(applicationPath, userSettingsFileName), JSON.stringify(userSettings));
    }
    catch (err) {
        // catch err
    }
}
